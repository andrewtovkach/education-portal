@model CourseDetailsViewModel
@{
    ViewData["Title"] = $"Курс {Model.CourseName}";
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Courses" asp-action="Index">Курсы</a></li>
        <li class="breadcrumb-item active" aria-current="page">Курс @Model.CourseName</li>
    </ol>
</nav>

<div class="page-header">
    <h1>Курс @Model.CourseName</h1>
    <hr />
</div>

<ul class="nav nav-tabs">
    @foreach (var module in Model.Modules)
        {
            <li class="nav-item">
                @if (module.Id == Model.ActiveModuleId)
                        {
                            <a class="nav-link active" asp-controller="Courses" asp-action="Details" asp-route-id="@Model.CourseId" asp-route-moduleId="@module.Id">Модуль @module.Name</a>
                        }
                        else
                        {
                            <a class="nav-link" asp-controller="Courses" asp-action="Details" asp-route-id="@Model.CourseId" asp-route-moduleId="@module.Id">Модуль @module.Name</a>
                        }
            </li>
        }
</ul>
<br />

<h3>Образовательные материалы</h3>

<table class="table">
    <thead class="thead-light">
        <tr>
            <th scope="col">Имя</th>
            <th scope="col">Важность</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var educationMaterial in Model.EducationMaterials)
        {
            <tr scope="row">
                <td>@educationMaterial.Name</td>
                <td><img src="~/icons/@educationMaterial.ImportanceIconName" height="30px" /></td>
                <td><a class="btn btn-primary" asp-controller="Courses" asp-action="EducationFileContent" asp-route-id="@educationMaterial.Id">Открыть</a></td>
            </tr>
        }
    </tbody>
</table>

<h3>Тесты</h3>

<table class="table">
    <thead class="thead-light">
        <tr>
            <th scope="col">Имя</th>
            <th scope="col">Кол-во вопросов</th>
            <th scope="col">Временные ограничения</th>
            <th scope="col">Кол-во попыток</th>
            <th scope="col">Средний результат</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var test in Model.Tests)
        {
                <tr scope="row">
                    <td>@test.Test.Name</td>
                    <td>@(test.Test.Questions?.Count ?? 0)</td>
                    <td>@test.Test.TimeLimit минут</td>
                    <td>
                        <span class="badge badge-primary">@test.AttemptsCount / @test.Test.MaxNumberOfAttempts</span>
                    </td>
                    <td>
                        @if (!test.AverageScore.HasValue)
                        {
                            <b>-</b>
                        }
                        else
                        {
                             if (test.AverageScore > 50)
                             {
                                 <span class="badge badge-success">@(string.Format("{0:0.00}", test.AverageScore))%</span>
                             }
                            else if (test.AverageScore > 20)
                            {
                                <span class="badge badge-warning">@(string.Format("{0:0.00}", test.AverageScore))%</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">@(string.Format("{0:0.00}", test.AverageScore))%</span>
                            }
                        }
                    </td>
                    <td>
                        @if (test.HasTestCompletions)
                        {
                             if (test.AttemptsCount < test.Test.MaxNumberOfAttempts)
                             {
                                 <div class="dropdown">
                                     <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                         Действия
                                     </button>
                                     <div class="dropdown-menu">
                                         <a class="dropdown-item" asp-controller="Tests" asp-action="Details" asp-route-id="@test.Test.Id">Пересдать</a>
                                         <a class="dropdown-item" asp-controller="Tests" asp-action="FinishedTest" asp-route-id="@test.Test.Id">Попытки</a>
                                     </div>
                                 </div>
                             }
                             else
                             {
                                 <a class="btn btn-primary" asp-controller="Tests" asp-action="FinishedTest" asp-route-id="@test.Test.Id">Попытки</a>
                             }

                        }
                        else
                        {
                            <a class="btn btn-primary" asp-controller="Tests" asp-action="Details" asp-route-id="@test.Test.Id">Пройти</a>
                        }
                    </td>
                </tr>
        }
    </tbody>
</table>

